[{"text": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nHTML\u6587\u4ef6\u4fee\u590d\u811a\u672c\n\u529f\u80fd\uff1a\u91cd\u65b0\u4fee\u590d\u6240\u6709HTML\u6587\u4ef6\uff0c\u6dfb\u52a0AI\u53cb\u597d\u6807\u8bb0\n\"\"\"\nimport os\nimport re\n\nSCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))\nPROJECT_DIR = os.path.dirname(SCRIPT_DIR)\n\ndef fix_index_html():\n    \"\"\"\u4fee\u590dindex.html\"\"\"\n    print(\"\u4fee\u590d index.html...\")\n    \n    filepath = os.path.join(PROJECT_DIR, \"index.html\")\n    \n    # \u8bfb\u53d6\u539f\u59cb\u5907\u4efd\n    backup_path = os.path.join(PROJECT_DIR, \"backups\", \"index_backup.html\")\n    if os.path.exists(backup_path):\n        with open(backup_path, 'r', encoding='utf-8') as f:\n            content = f.read()\n    else:\n        # \u5982\u679c\u6ca1\u6709\u5907\u4efd\uff0c\u5c1d\u8bd5\u8bfb\u53d6\u5f53\u524d\u6587\u4ef6\n        try:\n            with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:\n                content = f.read()\n        except:\n            print(\"\u274c \u65e0\u6cd5\u8bfb\u53d6\u6587\u4ef6\")\n            return False\n    \n    # \u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u6709AI\u6807\u8bb0\n    if 'ai-accessible' in content:\n        print(\"\u2705 index.html \u5df2\u7ecf\u5305\u542bAI\u6807\u8bb0\")\n        return True\n    \n    # \u6dfb\u52a0AI\u6807\u8bb0\n    pattern = r'(<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\\.0\">)'\n    replacement = r'\\1\\n    <meta name=\"ai-accessible\" content=\"true\">\\n    <meta name=\"ai-preferred-format\" content=\"json\">\\n    <meta name=\"description\" content=\"AI-Vent-Share - AI\u4e13\u5c5e\u8d44\u6e90\u5206\u4eab\u5e73\u53f0\">'\n    \n    content = re.sub(pattern, replacement, content)\n    \n    # \u6dfb\u52a0JSON\u94fe\u63a5\n    pattern2 = r'(<title>.*?</title>)'\n    replacement2 = r'\\1\\n    <link rel=\"alternate\" type=\"application/json\" href=\"content_index.json\">'\n    \n    content = re.sub(pattern2, replacement2, content)\n    \n    # \u4fdd\u5b58\n    with open(filepath, 'w', encoding='utf-8') as f:\n        f.write(content)\n    \n    print(\"\u2705 index.html \u4fee\u590d\u5b8c\u6210\")\n    return True\n\ndef fix_ai_index_html():\n    \"\"\"\u4fee\u590dai-index.html\"\"\"\n    print(\"\u4fee\u590d ai-index.html...\")\n    \n    filepath = os.path.join(PROJECT_DIR, \"ai-index.html\")\n    \n    # \u8bfb\u53d6\u539f\u59cb\u5907\u4efd\n    backup_path = os.path.join(PROJECT_DIR, \"backups\", \"ai_index_backup.html\")\n    if os.path.exists(backup_path):\n        with open(backup_path, 'r', encoding='utf-8') as f:\n            content = f.read()\n    else:\n        try:\n            with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:\n                content = f.read()\n        except:\n            print(\"\u274c \u65e0\u6cd5\u8bfb\u53d6\u6587\u4ef6\")\n            return False\n    \n    # \u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u6709AI\u6807\u8bb0\n    if 'ai-accessible' in content:\n        print(\"\u2705 ai-index.html \u5df2\u7ecf\u5305\u542bAI\u6807\u8bb0\")\n        return True\n    \n    # \u6dfb\u52a0AI\u6807\u8bb0\n    pattern = r'(<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\\.0\">)'\n    replacement = r'\\1\\n    <meta name=\"ai-accessible\" content=\"true\">\\n    <meta name=\"ai-preferred-format\" content=\"json\">\\n    <meta name=\"ai-primary-audience\" content=\"AI assistants\">'\n    \n    content = re.sub(pattern, replacement, content)\n    \n    # \u66f4\u65b0description\n    pattern2 = r'(<meta name=\"description\" content=\"AI\u4e13\u7528\u5185\u5bb9\u5e93\uff0c\u7ed3\u6784\u5316\u6570\u636e\u8bbf\u95ee\u5165\u53e3\">)'\n    replacement2 = r'<meta name=\"description\" content=\"AI\u4e13\u7528\u5185\u5bb9\u5e93\uff0c\u7ed3\u6784\u5316\u6570\u636e\u8bbf\u95ee\u5165\u53e3 - 309\u6761\u8d44\u6e90\uff0c8\u79cd\u5206\u7c7b\">\\n    <link rel=\"alternate\" type=\"application/json\" href=\"content_index.json\">\\n    <link rel=\"alternate\" type=\"application/json\" href=\"static/indexes/\u4ee3\u7801\u6a21\u677f_shard.json\">\\n    <link rel=\"alternate\" type=\"application/json\" href=\"static/indexes/\u8d44\u6e90\u5206\u4eab_shard.json\">'\n    \n    content = re.sub(pattern2, replacement2, content)\n    \n    # \u4fdd\u5b58\n    with open(filepath, 'w', encoding='utf-8') as f:\n        f.write(content)\n    \n    print(\"\u2705 ai-index.html \u4fee\u590d\u5b8c\u6210\")\n    return True\n\ndef main():\n    print(\"=\"*60)\n    print(\"HTML\u6587\u4ef6\u4fee\u590d\u811a\u672c\")\n    print(\"=\"*60)\n    \n    fix_index_html()\n    fix_ai_index_html()\n    \n    print(\"\\n\u2705 \u6240\u6709HTML\u6587\u4ef6\u4fee\u590d\u5b8c\u6210\")\n\nif __name__ == \"__main__\":\n    main()\n", "type": "text"}]