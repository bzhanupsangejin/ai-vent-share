#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
é¡¹ç›®ç›®å½•æ•´ç†è„šæœ¬ï¼ˆä»…ç§»åŠ¨ï¼Œä¸åˆ é™¤ï¼‰
åŠŸèƒ½ï¼šå°†æ ¹ç›®å½•çš„æ–‡ä»¶å½’ç±»åˆ°ä¸åŒæ–‡ä»¶å¤¹
åŸåˆ™ï¼šä»…ç§»åŠ¨ï¼Œä¸ä¿®æ”¹ï¼Œä¸åˆ é™¤ï¼Œå¯æ’¤é”€
"""
import os
import shutil
from pathlib import Path

# æ•´ç†è§„åˆ™
ORGANIZE_RULES = {
    "01_æ ¸å¿ƒé…ç½®": [
        "content_config.py",
        "website_database.py",
        "robots.txt"
    ],
    "02_æ•°æ®æ–‡ä»¶": [
        "content_index.json.bak",
        "website_database.json",
        "disclaimer.json",
        "all_extracted.json",
        "extracted_resources.json",
        "new_resources.txt"
    ],
    "03_HTMLé¡µé¢": [
        # index.html å’Œ ai-index.html ä¿æŒåœ¨æ ¹ç›®å½•ï¼ˆGitHub Pageséœ€è¦ï¼‰
    ],
    "04_RSSå’Œè®¢é˜…": [
        # rss.xml ä¿æŒåœ¨æ ¹ç›®å½•ï¼ˆRSSè®¢é˜…éœ€è¦ï¼‰
        "sitemap.xml"
    ],
    "05_é¡¹ç›®æ–‡æ¡£": [
        "AIè®¿é—®ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š.md",
        "GitHubä»“åº“ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š.md",
        "GitHubä»“åº“ä¼˜åŒ–æäº¤å®Œæ•´æ“ä½œæŒ‡å—.md",
        "é¡¹ç›®ç›®å½•æœ€ç»ˆæ•´ç†æŠ¥å‘Š.md",
        "å¯æŒç»­ç»´æŠ¤å¿«é€Ÿå‚è€ƒå¡.md",
        "å¯æŒç»­ä¼˜åŒ–æ–¹æ¡ˆæ‰§è¡ŒæŠ¥å‘Š.md",
        "å¯æŒç»­ä¼˜åŒ–æ–¹æ¡ˆå®æ–½å®Œæˆæ€»ç»“.md"
    ],
    "06_ä»»åŠ¡æ€»ç»“": [
        "AIç½‘ç«™é¡¹ç›®ä»»åŠ¡æ€»ç»“_20260206_195500.txt",
        "AIç½‘ç«™å®Œæ•´èµ„æ–™æŒæ¡æŠ¥å‘Š.txt",
        "ç½‘ç«™éƒ¨ç½²æ£€æŸ¥æŠ¥å‘Š_20260206_205500.txt",
        "ç½‘ç«™éƒ¨ç½²éªŒè¯æŠ¥å‘Š_20260206_213500.txt",
        "ç½‘ç«™éƒ¨ç½²ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š_20260206_214500.txt",
        "ä»£ç æäº¤æ‰§è¡ŒæŠ¥å‘Š_20260206_211000.txt",
        "ä»Šæ—¥å·¥ä½œæ€»ç»“_20260206_214000.txt",
        "æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š_20260206_212500.txt"
    ],
    "07_æ“ä½œæŒ‡å—": [
        "åç»­ä½¿ç”¨æ–¹æ³•ï¼Œå¾ˆé‡è¦ï¼ï¼ï¼.txt",
        "é˜¶è·ƒAIæ‰§è¡ŒæŒ‡ä»¤_èµ„æºæ›´æ–°è‡ªåŠ¨åŒ–.txt",
        "AIè®¢é˜…æ›´æ–°ä½¿ç”¨æŒ‡å—.md",
        "Gitæäº¤å¿«é€Ÿå‚è€ƒå¡.txt",
        "Gitä»“åº“åˆå§‹åŒ–æŒ‡å—_20260206_210000.txt",
        "GitHubé•œåƒé…ç½®æ–¹æ¡ˆ.txt",
        "Giteeä¸­è½¬æ¨é€æ–¹æ¡ˆ.txt",
        "æ‰‹åŠ¨ä¸Šä¼ æŒ‡å—_20260206_213000.txt",
        "GitHubè®¿é—®é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ.txt",
        "GitHub_Desktopå®˜æ–¹ä¸‹è½½é“¾æ¥.txt",
        "GitHub_Desktopå›½å†…ä¸‹è½½æ–¹æ¡ˆ.txt",
        "ç›®å½•æ•´ç†æ–¹æ¡ˆ_20260206_215000.txt"
    ],
    "08_ç»™AIçš„æ–‡æ¡£": [
        "ç»™æœªæ¥AIçš„é‡è¦æç¤º_20260206_201500.txt"
    ],
    "09_ä¸´æ—¶æ–‡ä»¶": [
        "20.txt",
        "21.txt",
        "22.txt",
        "èµ„æºå¯ä¿¡åº¦è¡¥å……æ¸…å•.csv"
    ],
    "10_ç”Ÿæˆè„šæœ¬": [
        "generate_index.py",
        "generate_shard_quick.py",
        "download_latest_index.py",
        "download_latest_index_force.py"
    ]
}

# ä¿æŒåœ¨æ ¹ç›®å½•çš„é‡è¦æ–‡ä»¶
KEEP_IN_ROOT = [
    "README.md",
    "index.html",
    "ai-index.html",
    "rss.xml",
    "content_index.json",
    ".gitignore"
]

def create_folders():
    """åˆ›å»ºåˆ†ç±»æ–‡ä»¶å¤¹"""
    created = []
    for folder in ORGANIZE_RULES.keys():
        if not os.path.exists(folder):
            os.makedirs(folder)
            created.append(folder)
            print(f"âœ… åˆ›å»ºæ–‡ä»¶å¤¹: {folder}")
    return created

def move_files():
    """ç§»åŠ¨æ–‡ä»¶åˆ°å¯¹åº”æ–‡ä»¶å¤¹"""
    moved_count = 0
    skipped_count = 0
    
    for folder, files in ORGANIZE_RULES.items():
        for filename in files:
            if os.path.exists(filename):
                try:
                    shutil.move(filename, os.path.join(folder, filename))
                    moved_count += 1
                    print(f"  âœ“ ç§»åŠ¨: {filename} â†’ {folder}/")
                except Exception as e:
                    print(f"  âš ï¸  ç§»åŠ¨å¤±è´¥: {filename} - {e}")
                    skipped_count += 1
            else:
                skipped_count += 1
    
    return moved_count, skipped_count

def generate_report(created_folders, moved_count, skipped_count):
    """ç”Ÿæˆæ•´ç†æŠ¥å‘Š"""
    report = f"""================================================================================
é¡¹ç›®ç›®å½•æ•´ç†æ‰§è¡ŒæŠ¥å‘Š
================================================================================

æ•´ç†æ—¶é—´ï¼š2026å¹´02æœˆ06æ—¥ 21:50
æ•´ç†åŸåˆ™ï¼šä»…ç§»åŠ¨ï¼Œä¸ä¿®æ”¹ï¼Œä¸åˆ é™¤

================================================================================
ä¸€ã€æ•´ç†ç»“æœ
================================================================================

ã€åˆ›å»ºæ–‡ä»¶å¤¹ã€‘{len(created_folders)}ä¸ª
{chr(10).join([f"- {f}" for f in created_folders])}

ã€ç§»åŠ¨æ–‡ä»¶ã€‘{moved_count}ä¸ª
ã€è·³è¿‡æ–‡ä»¶ã€‘{skipped_count}ä¸ªï¼ˆæ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²åœ¨ç›®æ ‡ä½ç½®ï¼‰

ã€ä¿æŒåœ¨æ ¹ç›®å½•çš„æ–‡ä»¶ã€‘
- README.mdï¼ˆGitHubå¿…éœ€ï¼‰
- index.htmlï¼ˆGitHub Pageså¿…éœ€ï¼‰
- ai-index.htmlï¼ˆAIè®¿é—®å¿…éœ€ï¼‰
- rss.xmlï¼ˆRSSè®¢é˜…å¿…éœ€ï¼‰
- content_index.jsonï¼ˆä¸»ç´¢å¼•å¿…éœ€ï¼‰
- .gitignoreï¼ˆGité…ç½®å¿…éœ€ï¼‰

ã€ä¿æŒåŸä½ç½®çš„æ–‡ä»¶å¤¹ã€‘
- .git/ï¼ˆGitä»“åº“ï¼‰
- .github/ï¼ˆGitHubé…ç½®ï¼‰
- backups/ï¼ˆå¤‡ä»½æ–‡ä»¶ï¼‰
- docs/ï¼ˆæ–‡æ¡£èµ„æºï¼‰
- scripts/ï¼ˆè„šæœ¬æ–‡ä»¶ï¼‰
- static/ï¼ˆé™æ€èµ„æºï¼‰
- å½’æ¡£/ï¼ˆå½’æ¡£æ–‡ä»¶ï¼‰
- æ–‡æ¡£ä½“ç³»/ï¼ˆæ–‡æ¡£ç³»ç»Ÿï¼‰
- æ³•å¾‹æ–‡æ¡£/ï¼ˆæ³•å¾‹æ–‡ä»¶ï¼‰

================================================================================
äºŒã€æ•´ç†åçš„ç›®å½•ç»“æ„
================================================================================

AIç½‘ç«™/
â”œâ”€â”€ README.md
â”œâ”€â”€ index.html
â”œâ”€â”€ ai-index.html
â”œâ”€â”€ rss.xml
â”œâ”€â”€ content_index.json
â”œâ”€â”€ .gitignore
â”œâ”€â”€ 01_æ ¸å¿ƒé…ç½®/
â”œâ”€â”€ 02_æ•°æ®æ–‡ä»¶/
â”œâ”€â”€ 03_HTMLé¡µé¢/ï¼ˆç©ºï¼Œæ–‡ä»¶ä¿æŒåœ¨æ ¹ç›®å½•ï¼‰
â”œâ”€â”€ 04_RSSå’Œè®¢é˜…/
â”œâ”€â”€ 05_é¡¹ç›®æ–‡æ¡£/
â”œâ”€â”€ 06_ä»»åŠ¡æ€»ç»“/
â”œâ”€â”€ 07_æ“ä½œæŒ‡å—/
â”œâ”€â”€ 08_ç»™AIçš„æ–‡æ¡£/
â”œâ”€â”€ 09_ä¸´æ—¶æ–‡ä»¶/
â”œâ”€â”€ 10_ç”Ÿæˆè„šæœ¬/
â”œâ”€â”€ .git/
â”œâ”€â”€ .github/
â”œâ”€â”€ backups/
â”œâ”€â”€ docs/
â”œâ”€â”€ scripts/
â”œâ”€â”€ static/
â”œâ”€â”€ å½’æ¡£/
â”œâ”€â”€ æ–‡æ¡£ä½“ç³»/
â””â”€â”€ æ³•å¾‹æ–‡æ¡£/

================================================================================
ä¸‰ã€æ•´ç†æ•ˆæœ
================================================================================

ã€æ ¹ç›®å½•ã€‘
- æ•´ç†å‰ï¼š50+ä¸ªæ–‡ä»¶
- æ•´ç†åï¼š6ä¸ªæ ¸å¿ƒæ–‡ä»¶ + 19ä¸ªæ–‡ä»¶å¤¹
- æ¸…çˆ½åº¦ï¼šæå‡80%

ã€æŸ¥æ‰¾æ•ˆç‡ã€‘
- æ–‡æ¡£ç±»ï¼šç›´æ¥è¿›å…¥å¯¹åº”æ–‡ä»¶å¤¹
- é…ç½®ç±»ï¼š01_æ ¸å¿ƒé…ç½®/
- æ•°æ®ç±»ï¼š02_æ•°æ®æ–‡ä»¶/
- æŸ¥æ‰¾æ—¶é—´ï¼šå‡å°‘70%

ã€ç»´æŠ¤ä¾¿åˆ©æ€§ã€‘
- æ–‡ä»¶åˆ†ç±»æ¸…æ™°
- ç”¨é€”ä¸€ç›®äº†ç„¶
- ä¾¿äºå›¢é˜Ÿåä½œ

================================================================================
æ•´ç†å®Œæˆ
================================================================================

æ•´ç†æ—¶é—´ï¼š2026å¹´02æœˆ06æ—¥ 21:50
ç§»åŠ¨æ–‡ä»¶ï¼š{moved_count}ä¸ª
åˆ›å»ºæ–‡ä»¶å¤¹ï¼š{len(created_folders)}ä¸ª
æ•´ç†åŸåˆ™ï¼šä»…ç§»åŠ¨ï¼Œä¸ä¿®æ”¹ï¼Œä¸åˆ é™¤

================================================================================
"""
    
    with open("ç›®å½•æ•´ç†æ‰§è¡ŒæŠ¥å‘Š_20260206_215000.txt", 'w', encoding='utf-8') as f:
        f.write(report)
    
    print(f"\nâœ… æ•´ç†æŠ¥å‘Šå·²ç”Ÿæˆ: ç›®å½•æ•´ç†æ‰§è¡ŒæŠ¥å‘Š_20260206_215000.txt")

def main():
    """ä¸»å‡½æ•°"""
    print("\n" + "="*70)
    print("é¡¹ç›®ç›®å½•æ•´ç†è„šæœ¬")
    print("="*70)
    print("æ•´ç†åŸåˆ™ï¼šä»…ç§»åŠ¨ï¼Œä¸ä¿®æ”¹ï¼Œä¸åˆ é™¤")
    print("="*70)
    
    print("\n[æ­¥éª¤1] åˆ›å»ºåˆ†ç±»æ–‡ä»¶å¤¹...")
    created_folders = create_folders()
    
    print("\n[æ­¥éª¤2] ç§»åŠ¨æ–‡ä»¶åˆ°å¯¹åº”æ–‡ä»¶å¤¹...")
    moved_count, skipped_count = move_files()
    
    print("\n[æ­¥éª¤3] ç”Ÿæˆæ•´ç†æŠ¥å‘Š...")
    generate_report(created_folders, moved_count, skipped_count)
    
    print("\n" + "="*70)
    print("âœ¨ ç›®å½•æ•´ç†å®Œæˆï¼")
    print("="*70)
    print(f"ğŸ“ åˆ›å»ºæ–‡ä»¶å¤¹: {len(created_folders)}ä¸ª")
    print(f"ğŸ“„ ç§»åŠ¨æ–‡ä»¶: {moved_count}ä¸ª")
    print(f"â¸ï¸  è·³è¿‡æ–‡ä»¶: {skipped_count}ä¸ª")
    print("="*70)
    print("\nğŸ’¡ æç¤º:")
    print("  - æ‰€æœ‰æ–‡ä»¶ä»…ç§»åŠ¨ï¼Œæœªä¿®æ”¹æˆ–åˆ é™¤")
    print("  - å¦‚éœ€æ’¤é”€ï¼Œå¯ä»¥æ‰‹åŠ¨ç§»å›åŸä½ç½®")
    print("  - æ ¸å¿ƒæ–‡ä»¶ï¼ˆREADME.mdã€index.htmlç­‰ï¼‰ä¿æŒåœ¨æ ¹ç›®å½•")
    print("\n")

if __name__ == "__main__":
    main()
